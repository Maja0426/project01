$('[class^="inc_"]').each(function(i,e){try{var $root=$(e);var templatePath=$root.data("template");var $div=$('<div>');$div.load(templatePath,function(){var par=$(this);if(par.find('.inc_').length==0){$root.replaceWith(par.contents().unwrap());$.getScript("./js/scripts.js");}else{var done=function(parent,element){parent.replaceWith(element.contents().unwrap());$root.replaceWith(parent.html());};par.find('.inc_').each(function(i,el){var ele=$(el);var tPath=ele.data("template");var $sub=$('<div>');$sub.load(tPath,function(){ele.replaceWith($sub.contents().unwrap());done(par,ele);});});}});}catch(er){console.log("error loading: "+templatePath+"-"+er);}});